{"ast":null,"code":"import { Validators } from '@angular/forms';\nimport { finalize } from 'rxjs/operators';\nimport { keyImage } from 'token';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"../../providers/posts.service\";\nimport * as i3 from \"@shared/services/userService.service\";\nimport * as i4 from \"@core/services/util.service\";\nimport * as i5 from \"../../providers/image.service\";\nimport * as i6 from \"@angular/common\";\nimport * as i7 from \"../../../../shared/components/buttons/default-button/default-button.component\";\nimport * as i8 from \"../../../../shared/components/buttons/secondary-button/secondary-button.component\";\n\nfunction NewPostComponent_app_default_button_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"app-default-button\", 12);\n  }\n}\n\nfunction NewPostComponent_app_secondary_button_12_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"app-secondary-button\", 13);\n    i0.ɵɵlistener(\"click\", function NewPostComponent_app_secondary_button_12_Template_app_secondary_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r3 = i0.ɵɵnextContext();\n      return ctx_r3.clear();\n    });\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction NewPostComponent_div_13_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 14);\n    i0.ɵɵelement(1, \"img\", 15);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"src\", ctx_r2.urlImage, i0.ɵɵsanitizeUrl);\n  }\n}\n\nexport let NewPostComponent = /*#__PURE__*/(() => {\n  class NewPostComponent {\n    constructor(fb, postService, userServiceService, utilService, imageService) {\n      this.fb = fb;\n      this.postService = postService;\n      this.userServiceService = userServiceService;\n      this.utilService = utilService;\n      this.imageService = imageService;\n      this.file = new FormData();\n      this.form = this.fb.group({\n        text: [null, [Validators.required, Validators.minLength(6), Validators.maxLength(500)]],\n        image: [null],\n        arquivo: [null],\n        likes: [0],\n        tags: [null],\n        owner: [null, Validators.required]\n      });\n    }\n\n    ngOnInit() {\n      this.loadUser();\n      this.form.get('owner').setValue(this.userServiceService.userId);\n    }\n\n    loadUser() {\n      this.user = this.utilService.getUserSessionStorage();\n    }\n\n    newPost() {\n      this.postService.creat(this.formValue).subscribe(() => {\n        this.postService.updatePosts.emit();\n        this.form.reset();\n        this.form.get('owner').setValue(this.userServiceService.userId);\n      });\n    }\n\n    uploadeImage() {\n      if (this.file.get('media')) {\n        this.imageService.updateImage(this.file).pipe(finalize(() => this.newPost())).subscribe(res => {\n          this.form.get('image').setValue(res.data.media);\n          this.urlImage = null;\n          this.form.get('arquivo').setValue(null);\n          this.file.delete('media');\n        });\n      } else {\n        this.newPost();\n      }\n    }\n\n    onUploadChange(evt) {\n      const file = evt.target.files[0];\n\n      if (file) {\n        const fileReader = new FileReader();\n        fileReader.readAsDataURL(file);\n\n        fileReader.onloadend = () => this.urlImage = fileReader.result;\n\n        this.file.append('key', keyImage);\n        this.file.append('media', file);\n      }\n    }\n\n    clear() {\n      this.form.reset();\n      this.urlImage = null;\n      this.file.delete('media');\n      this.form.get('owner').setValue(this.userServiceService.userId);\n    }\n\n    get formValue() {\n      return Object.assign({}, this.form.getRawValue());\n    }\n\n  }\n\n  NewPostComponent.ɵfac = function NewPostComponent_Factory(t) {\n    return new (t || NewPostComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.PostsService), i0.ɵɵdirectiveInject(i3.UserServiceService), i0.ɵɵdirectiveInject(i4.UtilService), i0.ɵɵdirectiveInject(i5.ImageService));\n  };\n\n  NewPostComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: NewPostComponent,\n    selectors: [[\"app-new-post\"]],\n    decls: 14,\n    vars: 6,\n    consts: [[3, \"formGroup\", \"ngSubmit\"], [1, \"card\"], [1, \"card-title\"], [\"alt\", \"Picture\", 3, \"src\"], [\"rows\", \"2\", \"placeholder\", \"Criar nova publica\\u00E7\\u00E3o...\", \"formControlName\", \"text\", \"minlength\", \"6\", \"maxlength\", \"500\"], [1, \"card-body\"], [\"for\", \"arquivo\"], [1, \"far\", \"fa-image\"], [\"type\", \"file\", \"id\", \"arquivo\", \"name\", \"arquivo\", \"accept\", \".jpg, .png\", \"formControlName\", \"arquivo\", 3, \"multiple\", \"change\"], [\"class\", \"fade-in\", \"label\", \"Publicar\", \"type\", \"submit\", 4, \"ngIf\"], [\"class\", \"fade-in\", \"label\", \"Cancelar\", 3, \"click\", 4, \"ngIf\"], [\"class\", \"card-body pt-0\", 4, \"ngIf\"], [\"label\", \"Publicar\", \"type\", \"submit\", 1, \"fade-in\"], [\"label\", \"Cancelar\", 1, \"fade-in\", 3, \"click\"], [1, \"card-body\", \"pt-0\"], [\"alt\", \"\", \"id\", \"img\", 1, \"image-preview\", 3, \"src\"]],\n    template: function NewPostComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"form\", 0);\n        i0.ɵɵlistener(\"ngSubmit\", function NewPostComponent_Template_form_ngSubmit_0_listener() {\n          return ctx.uploadeImage();\n        });\n        i0.ɵɵelementStart(1, \"div\", 1);\n        i0.ɵɵelementStart(2, \"div\", 2);\n        i0.ɵɵelement(3, \"img\", 3);\n        i0.ɵɵelement(4, \"textarea\", 4);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(5, \"div\", 5);\n        i0.ɵɵelementStart(6, \"label\", 6);\n        i0.ɵɵelement(7, \"i\", 7);\n        i0.ɵɵtext(8, \" Imagem \");\n        i0.ɵɵelementStart(9, \"input\", 8);\n        i0.ɵɵlistener(\"change\", function NewPostComponent_Template_input_change_9_listener($event) {\n          return ctx.onUploadChange($event);\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(10, \"div\");\n        i0.ɵɵtemplate(11, NewPostComponent_app_default_button_11_Template, 1, 0, \"app-default-button\", 9);\n        i0.ɵɵtemplate(12, NewPostComponent_app_secondary_button_12_Template, 1, 0, \"app-secondary-button\", 10);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(13, NewPostComponent_div_13_Template, 2, 1, \"div\", 11);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵproperty(\"formGroup\", ctx.form);\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"src\", ctx.user == null ? null : ctx.user.picture, i0.ɵɵsanitizeUrl);\n        i0.ɵɵadvance(6);\n        i0.ɵɵproperty(\"multiple\", false);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", ctx.form.valid);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.form.valid || !!ctx.urlImage);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.urlImage);\n      }\n    },\n    directives: [i1.ɵNgNoValidate, i1.NgControlStatusGroup, i1.FormGroupDirective, i1.DefaultValueAccessor, i1.NgControlStatus, i1.FormControlName, i1.MinLengthValidator, i1.MaxLengthValidator, i6.NgIf, i7.DefaultButtonComponent, i8.SecondaryButtonComponent],\n    styles: [\".card-title[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;margin-bottom:0;border:none}.card-title[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{position:relative;width:37px;height:37px;border-radius:50%;margin-right:15px}.card-title[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{width:100%;resize:none;border:none}.card-title[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]::placeholder{color:#ccc}.card-title[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{box-shadow:0 0;outline:0}.card-body[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.card-body[_ngcontent-%COMP%]   input[type=file][_ngcontent-%COMP%]{display:none}.card-body[_ngcontent-%COMP%]   .image-preview[_ngcontent-%COMP%]{width:150px;border-radius:12px}.card-body[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{color:#4caf50;padding:0 5px;text-align:center;cursor:pointer;border:1px solid #4CAF50;border-radius:4px;font-size:.8rem;display:flex;align-items:center;height:22px}.card-body[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:.5rem}.card-body[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:hover{background-color:#4caf50;color:#fff}.card-body[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:not(:last-child){margin-right:.5rem}\"]\n  });\n  return NewPostComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}